# AGQ Nomenclature Guide

**Version:** 1.0
**Status:** Canonical Reference
**Authority:** Based on `agenix/docs/architecture/execution-layers.md`

---

## Purpose

This document defines the canonical terminology for the AGX/AGQ/AGW ecosystem. **All code, documentation, API endpoints, and communication must use these exact terms.**

---

## The Five Execution Layers

### 1. Task
**Definition:** The smallest possible executable operation in the system.

**Characteristics:**
- Executes a single tool or AU (Agentic Unit)
- stdin → tool/AU → stdout
- Deterministic
- **Executed by:** AGW
- **Created by:** AGX (as part of a Plan)

**Example:**
```json
{
  "task_number": 1,
  "command": "sort",
  "args": ["-r"],
  "timeout_secs": 30
}
```

**❌ Do NOT call:** Step, operation, command unit

---

### 2. Plan
**Definition:** A deterministic, linear structure describing what to do, step-by-step.

**Characteristics:**
- **Contains:** Ordered list of Tasks
- **Format:** JSON
- **Structure:** Linear (Phase 1), may support DAGs (future)
- **Generated by:** AGX
- **Executed by:** AGW (as part of a Job)
- **Stored by:** AGQ (for reuse)

**Example:**
```json
{
  "plan_id": "uuid-5678",
  "plan_description": "Sort and deduplicate data",
  "tasks": [
    {
      "task_number": 1,
      "command": "sort",
      "args": ["-r"],
      "timeout_secs": 30
    },
    {
      "task_number": 2,
      "command": "uniq",
      "args": [],
      "input_from_task": 1,
      "timeout_secs": 30
    }
  ]
}
```

**❌ Do NOT call:** Job template, workflow template, job envelope

---

### 3. Job
**Definition:** The concrete runtime instance of a Plan.

**Characteristics:**
- **One Job = One Plan execution**
- **Tracked by:** AGQ (status, timestamps, logs, retries)
- **Pulled by:** Single AGW via BRPOP
- **Executed by:** Single AGW
- **Has:** job_id, status, started_at, completed_at, stdout, stderr

**Job Lifecycle:**
```
pending → running → completed
                 ↓
               failed → retry → running
                             ↓
                           dead
```

**Example:**
```json
{
  "job_id": "uuid-9999",
  "action_id": "uuid-1234",
  "plan": { /* embedded Plan */ },
  "input": {"data": "input1.txt"},
  "status": "pending",
  "created_at": "2025-11-15T20:00:00Z"
}
```

**❌ Do NOT call:** Plan instance, execution, job request

---

### 4. Action
**Definition:** Embarrassingly-parallel execution of many Jobs applying the same Plan to different inputs.

**Characteristics:**
- **Fan-out parallelism:** One Plan → Many Jobs
- **Batch processing:** Apply same transformation to multiple inputs
- **High throughput:** Workers process Jobs in parallel
- **Submitted by:** AGX
- **Managed by:** AGQ
- **Executed by:** Many AGWs

**Example:**
```json
{
  "action_id": "uuid-1234",
  "plan_id": "uuid-5678",
  "inputs": [
    {"data": "file1.txt"},
    {"data": "file2.txt"},
    {"data": "file3.txt"}
  ]
}
```

**Result:** 3 Jobs created, each with same Plan but different input

**❌ Do NOT call:** Batch job, parallel execution, job group

---

### 5. Workflow *(Future Phase)*
**Definition:** Orchestrates multiple Actions or Plans with conditional logic.

**Characteristics:**
- **Chained Actions:** Output of one Action feeds next
- **Conditional branching:** if/else logic
- **Complex orchestration:** Multi-stage processing
- **Status:** Not yet implemented

**❌ Do NOT call:** Pipeline, DAG (until properly supported)

---

## AGQ Responsibilities

Per the canonical spec, AGQ must:

| Responsibility | Description | API |
|----------------|-------------|-----|
| **Store Plans** | Accept and persist Plan definitions | `PLAN.SUBMIT` |
| **Manage Jobs** | Track Job lifecycle and metadata | `JOB.STATUS`, `JOB.LIST` |
| **Schedule Actions** | Fan-out Jobs from Actions | `ACTION.SUBMIT` |
| **Queue Jobs** | Enqueue Jobs for workers | `LPUSH queue:ready` |
| **Provide Observability** | Enable monitoring and debugging | `JOB.STATUS`, logs |

---

## Terminology Mapping

### What We Used to Say → What We Say Now

| ❌ OLD (Incorrect) | ✅ NEW (Correct) | Context |
|-------------------|-----------------|---------|
| "Step" | **Task** | Atomic execution unit |
| "Job envelope" | **Plan** | When referring to the definition |
| "Job instance" | **Job** | Runtime execution |
| "Job template" | **Plan** | Reusable definition |
| "Batch job" | **Action** | Parallel execution |
| "Step count" | **Task count** | Number of Tasks |
| "Execute step" | **Execute Task** | Function/method names |
| "Plan.steps" | **Plan.tasks** | Struct field |

---

## References

- **Authoritative spec:** `agenix/docs/architecture/execution-layers.md` (canonical source)
- **Local stub:** `agx/docs/EXECUTION-LAYERS.md` (links to canonical)
- **Alignment tracking:** AGQ Issue #21 (AGQ-016)
- **AI agent guidelines:** `CLAUDE.md` section 1.1

---

## Changelog

- **2025-11-17**: Updated references to point to agenix canonical location
- **2025-11-15**: Initial version (AGQ-016 Phase 1)

---

**Maintained by:** AGX Core Team
**Review cycle:** Quarterly
**Questions?** Consult `agenix/docs/architecture/execution-layers.md`
